<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rhythm Garden - Interactive Music Adventure</title>
    <script src="script.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-bg: rgba(255, 255, 255, 0.15);
            --card-border: rgba(255, 255, 255, 0.2);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.8);
            --success-color: #4CAF50;
            --error-color: #FF5252;
            --accent-color: #FFD700;
        }

        .high-contrast {
            --primary-bg: #000000;
            --card-bg: #1a1a1a;
            --card-border: #ffffff;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --success-color: #00ff00;
            --error-color: #ff0000;
            --accent-color: #ffff00;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--primary-bg);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: var(--text-primary);
            overflow-x: hidden;
            position: relative;
        }

        /* Floating particles background */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: float 6s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0; }
            50% { transform: translateY(-100px) rotate(180deg); opacity: 1; }
        }

        .container {
            max-width: 100vw;
            margin: 0 auto;
            padding: 10px;
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 2;
        }

        .accessibility-panel {
            position: fixed;
            top: 15px;
            right: 15px;
            background: var(--card-bg);
            backdrop-filter: blur(15px);
            padding: 12px;
            border-radius: 12px;
            display: flex;
            gap: 8px;
            z-index: 1000;
            border: 2px solid var(--card-border);
        }

        .accessibility-btn {
            padding: 8px 12px;
            border: 2px solid var(--card-border);
            border-radius: 8px;
            background: var(--card-bg);
            color: var(--text-primary);
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 44px;
            min-height: 44px;
        }

        .accessibility-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .accessibility-btn:focus {
            outline: 3px solid var(--accent-color);
            outline-offset: 2px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px 0;
        }

        .header h1 {
            font-size: clamp(2rem, 5vw, 4rem);
            margin-bottom: 8px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #FFD700, #FFA500, #FF6B6B);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(45deg); }
        }

        .header p {
            font-size: clamp(1rem, 2vw, 1.3rem);
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .game-layout {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            flex: 1;
            align-items: start;
        }

        .garden-container {
            background: var(--card-bg);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid var(--card-border);
            min-height: 500px;
        }

        .garden-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .garden-title {
            font-size: 1.5em;
            color: var(--accent-color);
        }

        .seed-selector {
            display: flex;
            gap: 10px;
        }

        .seed-btn {
            width: 50px;
            height: 50px;
            border: 2px solid var(--card-border);
            border-radius: 50%;
            background: var(--card-bg);
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .seed-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        .seed-btn.selected {
            border-color: var(--accent-color);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
            transform: scale(1.05);
        }

        .garden {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            min-height: 400px;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(139, 195, 74, 0.2));
            border-radius: 15px;
            padding: 20px;
            border: 3px dashed var(--card-border);
            position: relative;
        }

        .plant-slot {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 2px solid rgba(76, 175, 80, 0.3);
            position: relative;
            cursor: pointer;
        }

        .plant-slot:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .plant-slot.planted {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.4), rgba(139, 195, 74, 0.4));
            border-color: var(--success-color);
            animation: plantGrow 0.8s ease-out;
        }

        @keyframes plantGrow {
            0% { transform: scale(0) rotate(-180deg); opacity: 0; }
            50% { transform: scale(1.3) rotate(0deg); opacity: 0.7; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .plant-slot::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            background: linear-gradient(45deg, transparent, rgba(255, 215, 0, 0.3), transparent);
            border-radius: 20px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .plant-slot.planted::before {
            opacity: 1;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            0% { opacity: 0.3; }
            100% { opacity: 0.7; }
        }

        .rhythm-panel {
            background: var(--card-bg);
            backdrop-filter: blur(15px);
            padding: 25px;
            border-radius: 20px;
            border: 2px solid var(--card-border);
            position: sticky;
            top: 20px;
        }

        .status-section {
            text-align: center;
            margin-bottom: 25px;
        }

        .score-display {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }

        .score-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 12px;
            border-radius: 10px;
            border: 1px solid var(--card-border);
        }

        .score-label {
            font-size: 0.8em;
            opacity: 0.7;
            margin-bottom: 5px;
        }

        .score-value {
            font-size: 1.4em;
            font-weight: bold;
            color: var(--accent-color);
        }

        .progress-container {
            margin: 15px 0;
        }

        .progress {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            height: 25px;
            overflow: hidden;
            position: relative;
            border: 2px solid var(--card-border);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color), var(--accent-color));
            width: 0%;
            transition: width 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .game-status {
            font-size: 1.1em;
            font-weight: 600;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border: 2px solid var(--card-border);
            margin-bottom: 20px;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .rhythm-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 25px 0;
        }

        .rhythm-btn {
            width: 100px;
            height: 100px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            font-size: 2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
            justify-self: center;
        }

        .rhythm-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .rhythm-btn:hover::before {
            left: 100%;
        }

        .rhythm-btn:focus {
            outline: 4px solid var(--accent-color);
            outline-offset: 4px;
        }

        .rhythm-btn:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .rhythm-btn:active {
            transform: translateY(-4px) scale(0.98);
        }

        .btn-1 {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
        }

        .btn-2 {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
        }

        .btn-3 {
            background: linear-gradient(135deg, #45b7d1, #2196f3);
        }

        .btn-4 {
            background: linear-gradient(135deg, #96ceb4, #2ecc71);
        }

        .rhythm-btn.active {
            animation: buttonPulse 0.4s ease;
            transform: translateY(-8px) scale(1.15);
            box-shadow: 0 0 40px rgba(255, 255, 255, 0.8);
        }

        @keyframes buttonPulse {
            0% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-12px) scale(1.2); box-shadow: 0 0 50px rgba(255, 255, 255, 0.9); }
            100% { transform: translateY(-8px) scale(1.15); }
        }

        .controls {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 12px 20px;
            border: 2px solid var(--card-border);
            border-radius: 12px;
            background: var(--card-bg);
            color: var(--text-primary);
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            min-width: 44px;
            min-height: 44px;
        }

        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            background: rgba(255, 255, 255, 0.1);
        }

        .control-btn:focus {
            outline: 3px solid var(--accent-color);
            outline-offset: 2px;
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Success/Error Animations */
        .floating-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3em;
            font-weight: bold;
            pointer-events: none;
            z-index: 1000;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
        }

        .success-message {
            color: var(--success-color);
            animation: successFloat 2s ease-out forwards;
        }

        .error-message {
            color: var(--error-color);
            animation: errorShake 1s ease-out forwards;
        }

        @keyframes successFloat {
            0% { transform: translate(-50%, -50%) scale(0) rotate(-180deg); opacity: 0; }
            30% { transform: translate(-50%, -50%) scale(1.2) rotate(0deg); opacity: 1; }
            70% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; }
            100% { transform: translate(-50%, -70%) scale(0.8) rotate(0deg); opacity: 0; }
        }

        @keyframes errorShake {
            0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
            10%, 30%, 50%, 70%, 90% { transform: translate(-50%, -50%) rotate(-5deg); }
            20%, 40%, 60%, 80% { transform: translate(-50%, -50%) rotate(5deg); }
        }

        /* Vibration effect for visual feedback when sound is off */
        .vibrate {
            animation: vibrate 0.5s ease-in-out;
        }

        @keyframes vibrate {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            10% { transform: translateX(-10px) rotate(-2deg); }
            20% { transform: translateX(10px) rotate(2deg); }
            30% { transform: translateX(-8px) rotate(-1deg); }
            40% { transform: translateX(8px) rotate(1deg); }
            50% { transform: translateX(-6px) rotate(0deg); }
            60% { transform: translateX(6px) rotate(0deg); }
            70% { transform: translateX(-4px) rotate(0deg); }
            80% { transform: translateX(4px) rotate(0deg); }
            90% { transform: translateX(-2px) rotate(0deg); }
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .game-layout {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .rhythm-panel {
                position: static;
            }
            
            .accessibility-panel {
                position: relative;
                top: auto;
                right: auto;
                margin-bottom: 15px;
                justify-self: center;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 8px;
            }
            
            .garden {
                grid-template-columns: repeat(4, 1fr);
                gap: 10px;
                padding: 15px;
            }
            
            .plant-slot {
                width: 60px;
                height: 60px;
                font-size: 2em;
            }
            
            .rhythm-btn {
                width: 80px;
                height: 80px;
                font-size: 1.5em;
            }
            
            .score-display {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .rhythm-buttons {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
            
            .rhythm-btn {
                width: 70px;
                height: 70px;
            }
            
            .garden {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* High contrast mode specific styles */
        .high-contrast .rhythm-btn {
            border: 4px solid var(--text-primary);
        }

        .high-contrast .plant-slot {
            border: 3px solid var(--text-primary);
        }

        .high-contrast .floating-message {
            text-shadow: 2px 2px 0px #000000;
        }

        /* Instructions Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-content {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 20px;
            border: 2px solid var(--card-border);
            max-width: 500px;
            width: 90%;
            text-align: center;
        }

        .modal h2 {
            color: var(--accent-color);
            margin-bottom: 20px;
        }

        .modal p {
            margin-bottom: 15px;
            line-height: 1.6;
        }
    
    .plant-slot.locked {
    background: rgba(0, 0, 0, 0.25);
    color: #aaa;
    cursor: not-allowed;
    border: 2px dashed #444;
    font-size: 2em;
    pointer-events: auto;
}
.plant-slot.locked:hover {
    box-shadow: none;
    transform: none;
}

    </style>
</head>
<body>
    <div class="particles" id="particles"></div>
    
    <div class="accessibility-panel">
        <button class="accessibility-btn" onclick="toggleHighContrast()" aria-label="Toggle high contrast mode" title="High Contrast Mode">üé® Contrast</button>
        <button class="accessibility-btn" onclick="toggleMute()" aria-label="Toggle sound" title="Sound On/Off">üîä Sound</button>
        <button class="accessibility-btn" onclick="showInstructions()" aria-label="Show game instructions" title="How to Play">‚ÑπÔ∏è Help</button>
    </div>

    <div class="container">
        <header class="header">
            <h1>üéµ Rhythm Garden üå±</h1>
            <p>Create your magical musical garden by mastering rhythm patterns!</p>
        </header>

        <div class="game-layout">
            <div class="garden-container">
                <div class="garden-header">
                    <h2 class="garden-title">üå∫ Your Garden</h2>
                    <div class="seed-selector">
                        <button class="seed-btn selected" onclick="selectSeed('üåª')" data-seed="üåª" aria-label="Sunflower seed">üåª</button>
                        <button class="seed-btn" onclick="selectSeed('üåπ')" data-seed="üåπ" aria-label="Rose seed">üåπ</button>
                        <button class="seed-btn" onclick="selectSeed('üå∑')" data-seed="üå∑" aria-label="Tulip seed">üå∑</button>
                        <button class="seed-btn" onclick="selectSeed('üå∫')" data-seed="üå∫" aria-label="Hibiscus seed">üå∫</button>
                        <button class="seed-btn" onclick="selectSeed('üå∏')" data-seed="üå∏" aria-label="Cherry blossom seed">üå∏</button>
                        <button class="seed-btn" onclick="selectSeed('üåº')" data-seed="üåº" aria-label="Daisy seed">üåº</button>
                    </div>
                </div>
                <div class="garden" id="garden">
                    <!-- Plant slots will be generated by JavaScript -->
                </div>
            </div>

            <div class="rhythm-panel">
                <div class="status-section">
                    <div class="score-display">
                        <div class="score-item">
                            <div class="score-label">Score</div>
                            <div class="score-value" id="score">0</div>
                        </div>
                        <div class="score-item">
                            <div class="score-label">Level</div>
                            <div class="score-value" id="level">1</div>
                        </div>
                        <div class="score-item">
                            <div class="score-label">Plants</div>
                            <div class="score-value" id="plantCount">0</div>
                        </div>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress">
                            <div class="progress-bar" id="progress"></div>
                        </div>
                    </div>

                    <div class="game-status" id="gameStatus">
                        üéØ Press "Start New Pattern" to begin your musical journey!
                    </div>
                </div>

                <div class="rhythm-buttons">
                    <button class="rhythm-btn btn-1" data-note="0" aria-label="Red button - Low C note">üéµ<br><small>Q</small></button>
                    <button class="rhythm-btn btn-2" data-note="1" aria-label="Teal button - E note">üé∂<br><small>W</small></button>
                    <button class="rhythm-btn btn-3" data-note="2" aria-label="Blue button - G note">üéº<br><small>A</small></button>
                    <button class="rhythm-btn btn-4" data-note="3" aria-label="Green button - High B note">üéπ<br><small>S</small></button>
                </div>

                <div class="controls">
                    <button class="control-btn" id="playBtn" onclick="startNewPattern()">üéµ Start Pattern</button>
                    <button class="control-btn" id="replayBtn" onclick="replayPattern()" disabled>üîÑ Replay</button>
                    <button class="control-btn" onclick="resetGame()">üÜï New Game</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Instructions Modal -->
    <div class="modal" id="instructionsModal">
        <div class="modal-content">
            <h2>üéµ How to Play Rhythm Garden</h2>
            <p><strong>üéØ Goal:</strong> Match the rhythm patterns to grow a beautiful garden!</p>
            <p><strong>üéÆ Controls:</strong></p>
            <p>‚Ä¢ Use Q, W, A, S keys or click the colored buttons</p>
            <p>‚Ä¢ Listen to the pattern, then repeat it exactly</p>
            <p>‚Ä¢ Choose different seeds from the selector</p>
            <p>‚Ä¢ Click empty spots in your garden to plant</p>
            <p><strong>üåü Tips:</strong></p>
            <p>‚Ä¢ Perfect patterns earn bonus points</p>
            <p>‚Ä¢ Each level gets more challenging</p>
            <p>‚Ä¢ Different plants have different point values</p>
            <button class="control-btn" onclick="closeInstructions()">Got it! üå±</button>
        </div>
    </div>

    <!-- <script>
        // Game state
        let gameState = {
            score: 0,
            level: 1,
            currentPattern: [],
            playerInput: [],
            isPlaying: false,
            isListening: false,
            plants: 0,
            isMuted: false,
            timeoutIds: [],
            selectedSeed: 'üåª',
            plantedSeeds: [],
            combo: 0,
            totalPatterns: 0,
            // NEW: Per-plant score tracking
            earnedPoints: {
                'üåª': 0,
                'üåπ': 0,
                'üå∑': 0,
                'üå∫': 0,
                'üå∏': 0,
                'üåº': 0
            }
        };

        // Audio context and voice synthesis
        let audioContext;
        let gainNode;
        let speechSynth = window.speechSynthesis;
        let voices = [];

        // Plant properties for different seeds
        const plantProperties = {
            'üåª': { name: 'Sunflower', points: 10, sound: 'sunny' },
            'üåπ': { name: 'Rose', points: 15, sound: 'romantic' },
            'üå∑': { name: 'Tulip', points: 12, sound: 'spring' },
            'üå∫': { name: 'Hibiscus', points: 18, sound: 'tropical' },
            'üå∏': { name: 'Cherry Blossom', points: 20, sound: 'delicate' },
            'üåº': { name: 'Daisy', points: 8, sound: 'cheerful' }
        };

        // Encouraging phrases for success
        const successPhrases = [
            "Fantastic! Your garden is blooming beautifully!",
            "Perfect rhythm! You're a natural gardener!",
            "Amazing work! Keep that musical magic flowing!",
            "Spectacular! Your plants are dancing with joy!",
            "Incredible! You've got the rhythm of nature!",
            "Outstanding! Your garden sings with harmony!",
            "Brilliant performance! Mother Nature is impressed!",
            "Wonderful! Your musical garden is thriving!"
        ];

        // Encouraging phrases for errors
        const encouragementPhrases = [
            "Almost there! Try listening carefully to the rhythm!",
            "Don't worry! Every gardener learns from practice!",
            "So close! Feel the beat and try again!",
            "Keep going! Your garden believes in you!",
            "That's okay! Even the best musicians need practice!",
            "Try again! Listen with your heart this time!",
            "No worries! Rome wasn't built in a day, neither are gardens!",
            "Keep trying! Your plants are cheering you on!"
        ];

        // Load voices when available
        function loadVoices() {
            voices = speechSynth.getVoices();
            if (voices.length === 0) {
                setTimeout(loadVoices, 100);
            }
        }

        // Speak text with emotion
        function speak(text, options = {}) {
            if (gameState.isMuted) {
                // Enhanced visual feedback when muted
                document.body.classList.add('vibrate');
                setTimeout(() => document.body.classList.remove('vibrate'), 500);
                return;
            }

            speechSynth.cancel(); // Cancel any ongoing speech
            const utterance = new SpeechSynthesisUtterance(text);

            // Find a suitable voice
            const preferredVoice = voices.find(voice =>
                voice.lang.includes('en') &&
                (voice.name.includes('Female') || voice.name.includes('Google'))
            ) || voices.find(voice => voice.lang.includes('en')) || voices[0];
            // Game state continued...
            utterance.voice = preferredVoice || voices[0];
            utterance.rate = options.rate || 1;
            utterance.pitch = options.pitch || 1;
            utterance.volume = options.volume || 1;

            speechSynth.speak(utterance);
        }

        // Toggle high contrast
        function toggleHighContrast() {
            document.body.classList.toggle('high-contrast');
        }

        // Toggle mute
        function toggleMute() {
            gameState.isMuted = !gameState.isMuted;
            const btn = document.querySelector("[onclick='toggleMute()']");
            btn.textContent = gameState.isMuted ? 'üîá Muted' : 'üîä Sound';
        }

        // Show and hide instructions
        function showInstructions() {
            document.getElementById('instructionsModal').style.display = 'flex';
        }

        function closeInstructions() {
            document.getElementById('instructionsModal').style.display = 'none';
        }

        // Initialize
        window.onload = () => {
            loadVoices();
            setupGarden();
            bindControls();
        };

        // Setup garden slots
        function setupGarden() {
            const garden = document.getElementById('garden');
            for (let i = 0; i < 18; i++) {
                const slot = document.createElement('div');
                slot.classList.add('plant-slot');
                slot.setAttribute('tabindex', '0');
                slot.setAttribute('role', 'button');
                slot.setAttribute('aria-label', 'Empty plant slot');
                slot.addEventListener('click', () => plantSeed(slot));
                garden.appendChild(slot);
            }
        }

        // Seed selector
        function selectSeed(seed) {
            gameState.selectedSeed = seed;
            document.querySelectorAll('.seed-btn').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.dataset.seed === seed) btn.classList.add('selected');
            });
        }

        // Start new rhythm pattern
        function startNewPattern() {
            gameState.currentPattern = Array.from({length: gameState.level + 1}, () => Math.floor(Math.random() * 4));
            gameState.playerInput = [];
            gameState.isPlaying = true;
            gameState.isListening = false;
            updateStatus("üéß Listen to the pattern...");
            playPattern();
        }

        // Replay pattern
        function replayPattern() {
            if (!gameState.currentPattern.length) return;
            updateStatus("üéß Replaying pattern...");
            playPattern();
        }

        // Play pattern
        function playPattern() {
            disableButtons();
            gameState.timeoutIds.forEach(clearTimeout);
            gameState.timeoutIds = [];
            const buttons = document.querySelectorAll('.rhythm-btn');
            gameState.currentPattern.forEach((note, index) => {
                const timeout = setTimeout(() => {
                    const btn = buttons[note];
                    btn.classList.add('active');
                    setTimeout(() => btn.classList.remove('active'), 500);
                }, 800 * index);
                gameState.timeoutIds.push(timeout);
            });
            setTimeout(() => {
                enableButtons();
                updateStatus("üéµ Now it's your turn!");
                gameState.isListening = true;
            }, 800 * gameState.currentPattern.length);
        }

        // Button press handling
        function bindControls() {
            document.querySelectorAll('.rhythm-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (!gameState.isListening) return;
                    const note = parseInt(btn.dataset.note);
                    gameState.playerInput.push(note);
                    checkInput();
                });
            });

            document.addEventListener('keydown', e => {
                const keyMap = { 'q': 0, 'w': 1, 'a': 2, 's': 3 };
                if (!gameState.isListening || !keyMap.hasOwnProperty(e.key)) return;
                const note = keyMap[e.key];
                const btn = document.querySelector(`.rhythm-btn[data-note='${note}']`);
                btn.click();
            });
        }
        function setupGarden() {
    const garden = document.getElementById('garden');
    garden.innerHTML = '';
    for (let i = 0; i < 18; i++) {
        const slot = document.createElement('div');
        slot.classList.add('plant-slot');
        slot.setAttribute('tabindex', '0');
        slot.setAttribute('role', 'button');
        if (i >= gameState.unlockedPlots) {
            slot.classList.add('locked');
            slot.setAttribute('aria-label', 'Locked plant slot');
            slot.innerHTML = 'üîí';
            slot.addEventListener('click', () => {
                speak("This plot is still locked. Earn more points to unlock new plots.");
                showFloatingMessage("‚ùå Plot locked!", 'error');
                updateStatus("üå± Get 10 more points to unlock the next plot.");
            });
        } else {
            slot.setAttribute('aria-label', 'Empty plant slot');
            slot.addEventListener('click', () => plantSeed(slot));
        }
        garden.appendChild(slot);
    }
}
        // Check user input
        function checkInput() {
            const current = gameState.playerInput.length - 1;
            if (gameState.playerInput[current] !== gameState.currentPattern[current]) {
                handleMistake();
                return;
            }

            if (gameState.playerInput.length === gameState.currentPattern.length) {
                handleSuccess();
            }
        }

        // Handle success and per-plant points update
        function handleSuccess() {
            
            setupGarden();
            const seed = gameState.selectedSeed;
            const plant = plantProperties[seed];
            gameState.score += plant.points;
            gameState.plants++;
            gameState.level++;
            // NEW: Add points to seed-specific progress
            gameState.earnedPoints[seed] += plant.points;
            const newUnlocked = Math.min(18, Math.floor(gameState.score / 10)); // 18 is the max number of plots
    if (newUnlocked > gameState.unlockedPlots) {
        gameState.unlockedPlots = newUnlocked;
        updatePlotsLocking();
        showFloatingMessage(`üå± Plot #${gameState.unlockedPlots} unlocked!`, 'success');
        updateStatus(`A new plot has been unlocked!`);
    }

    updateScore();
    speak(successPhrases[Math.floor(Math.random() * successPhrases.length)]);
    showFloatingMessage("üå± Grow!", 'success');
    updateStatus("üåü Great job! Pattern matched!");
    updateProgress();
            updateScore();
            speak(successPhrases[Math.floor(Math.random() * successPhrases.length)]);
            showFloatingMessage("üå± Grow!", 'success');
            updateStatus("üåü Great job! Pattern matched!");
            updateProgress();
        }

        // Handle mistake
        function handleMistake() {
            speak(encouragementPhrases[Math.floor(Math.random() * encouragementPhrases.length)]);
            showFloatingMessage("‚ùå Oops!", 'error');
            updateStatus("üîÅ Try again!");
            gameState.combo = 0;
        }

        // Plant seed in clicked slot, ENFORCING THE PER-PLANT SCORE REQUIREMENT
        function plantSeed(slot) {
            if (slot.classList.contains('planted')) return;

            const seed = gameState.selectedSeed;
            const pointsNeeded = 10;

            if (gameState.earnedPoints[seed] < pointsNeeded) {
                // Can't plant yet
                speak(`You need ${pointsNeeded} points to plant a ${plantProperties[seed].name}`);
                showFloatingMessage(`‚ùå Earn more ${seed} points`, 'error');
                updateStatus(`üîí Earn ${pointsNeeded} points with ${seed} before planting.`);
                return;
            }

            // Allowed to plant
            slot.textContent = seed;
            slot.classList.add('planted');
            slot.setAttribute('aria-label', `${seed} planted`);
            showFloatingMessage("üå± Planted!", 'success');
            updateStatus(`üåº You planted a ${plantProperties[seed].name}!`);
        }

        // Reset game
        function resetGame() {

            gameState = {
                score: 0,
                level: 1,
                currentPattern: [],
                playerInput: [],
                isPlaying: false,
                isListening: false,
                plants: 0,
                isMuted: false,
                timeoutIds: [],
                selectedSeed: 'üåª',
                plantedSeeds: [],
                combo: 0,
                totalPatterns: 0,
                // RESET earned points as well!
                earnedPoints: {
                    'üåª': 0,
                    'üåπ': 0,
                    'üå∑': 0,
                    'üå∫': 0,
                    'üå∏': 0,
                    'üåº': 0
                }
            };
            document.getElementById('garden').innerHTML = '';
            setupGarden();
            updateScore();
            updateProgress();
            updateStatus("üéØ Press \"Start New Pattern\" to begin your musical journey!");
        }

        // Utility updates
        function updateScore() {
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('plantCount').textContent = gameState.plants;
        }

        function updateStatus(message) {
            document.getElementById('gameStatus').textContent = message;
        }

        function updateProgress() {
            const progress = (gameState.level / 10) * 100;
            document.getElementById('progress').style.width = `${progress}%`;
        }

        function disableButtons() {
            document.querySelectorAll('.rhythm-btn').forEach(btn => btn.disabled = true);
        }

        function enableButtons() {
            document.querySelectorAll('.rhythm-btn').forEach(btn => btn.disabled = false);
            document.getElementById('replayBtn').disabled = false;
        }

        function showFloatingMessage(text, type) {
            const msg = document.createElement('div');
            msg.className = `floating-message ${type === 'success' ? 'success-message' : 'error-message'}`;
            msg.textContent = text;
            document.body.appendChild(msg);
            setTimeout(() => msg.remove(), 2000);
        }
    </script> -->
</body>
</html>
